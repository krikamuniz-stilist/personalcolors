<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Personal Colors – Questionário + Laudo</title>
<link rel="icon" href="favicon.ico">
<meta name="theme-color" content="#d8d2cf">
<style>
:root{--page:#d8d2cf;--ink:#111827;--muted:#6b7280;--card:#fff;--brand:#7c3aed}
*{box-sizing:border-box} html,body{margin:0;background:var(--page);color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
.wrap{max-width:1000px;margin:28px auto;padding:0 14px 60px}
header{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:14px}
.brandbox{display:flex;align-items:center;gap:10px} .brandbox img{max-height:40px;object-fit:contain}
.h1{font-weight:800;font-size:20px} .muted{color:var(--muted);font-size:13px}
.card{background:var(--card);border:1px solid #e5e7eb;border-radius:14px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
.grid{display:grid;gap:12px} .g2{grid-template-columns:repeat(2,minmax(0,1fr))} .g3{grid-template-columns:repeat(3,minmax(0,1fr))}
label{font-weight:600;display:block;margin-bottom:6px} input,select,textarea{width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff}
.btn{border:0;border-radius:10px;padding:11px 14px;font-weight:700;cursor:pointer} .p{background:var(--brand);color:#fff} .g{background:#fff;border:1px solid #e5e7eb}
.row{display:flex;gap:10px;flex-wrap:wrap} .badge{border:1px solid #e5e7eb;border-radius:999px;padding:6px 10px;font-size:12px;background:#fff}
.swatches{display:grid;grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:8px} .sw{border:1px solid #e5e7eb;border-radius:10px;overflow:hidden;background:#fff}
.chip{height:60px} .meta{padding:6px 8px;font-size:12px}
.hidden{display:none !important} .toast{position:fixed;right:14px;bottom:14px;background:#111827;color:#fff;padding:10px 12px;border-radius:10px}
@media print{body{background:#fff} .noprint{display:none !important} .wrap{max-width:none;padding:0} .card{border:0;box-shadow:none;border-radius:0} }
</style>
</head>
<body>
<div class="wrap">
  <header class="noprint">
    <div class="brandbox">
      <img id="logoPreview" alt="logo">
      <div><div class="h1" id="brandPreview">Colorimetria & Pantone</div><div class="muted" id="taglinePreview">Questionário + Laudo</div></div>
    </div>
    <div class="muted">v2 compacto</div>
  </header>

  <section id="builder" class="card">
    <div class="grid g3">
      <div><label>Marca</label><input id="brandName" placeholder="Ex.: Erika Muniz – Personal Stylist"></div>
      <div><label>Tagline</label><input id="tagline" placeholder="Ex.: Consultoria de Imagem & Estilo"></div>
      <div><label>Logo (PNG/JPG)</label><input id="logoFile" type="file" accept="image/*"></div>
    </div>
    <div class="grid g3" style="margin-top:6px">
      <div>
        <label>Fundo da página (manual)</label>
        <div class="row"><input id="pageBg" type="color" value="#d8d2cf" style="width:60px;padding:0;height:40px"><button id="applyBg" class="btn g">Aplicar</button><button id="resetBg" class="btn g">Padrão</button></div>
        <div class="muted" id="bgNow">Fundo atual: #d8d2cf</div>
      </div>
      <div><label>Cor da marca</label><input id="brandColor" type="color" value="#7c3aed"></div>
      <div><label>Contato (opcional)</label><input id="contact" placeholder="email • fone • @insta"></div>
    </div>

    <hr style="margin:14px 0;border:0;border-top:1px solid #e5e7eb">

    <div class="grid g3">
      <div><label>1. Bronzeia ou fica vermelha?</label><select id="q1"><option value="">—</option><option>Bronzeia facilmente</option><option>Fica vermelha antes</option></select></div>
      <div><label>2. Fundo de pele</label><select id="q2"><option value="">—</option><option>Dourado/Oliva</option><option>Neutro</option><option>Rosado/Azulado</option></select></div>
      <div><label>3. Acessórios</label><select id="q3"><option value="">—</option><option>Dourado</option><option>Prata</option><option>Ambos</option></select></div>
      <div><label>4. Cabelo</label><select id="q4"><option value="">—</option><option>Dourados</option><option>Acinzentados</option><option>Avermelhados</option><option>Neutros</option></select></div>
      <div><label>5. Olhos</label><select id="q5"><option value="">—</option><option>Quente (dourado/mel)</option><option>Neutro</option><option>Frio (acinzentado/azulado)</option></select></div>
      <div><label>7. Contraste</label><select id="q7"><option value="">—</option><option>Alto</option><option>Médio</option><option>Baixo</option></select></div>
      <div><label>10. Branco</label><select id="q10"><option value="">—</option><option>Branco gelo</option><option>Branco neve</option><option>Empate</option></select></div>
      <div><label>11. Rosa</label><select id="q11"><option value="">—</option><option>Rosa pink</option><option>Coral</option><option>Empate</option></select></div>
      <div><label>12. Azul × Verde</label><select id="q12"><option value="">—</option><option>Azul royal</option><option>Verde oliva</option><option>Empate</option></select></div>
      <div><label>14. Preferência</label><select id="q14"><option value="">—</option><option>Discreta/Neutra</option><option>Vibrante/Intensa</option><option>Romântica/Pastel</option><option>Dramática/Profunda</option></select></div>
      <div><label>Cliente</label><input id="cliente" placeholder="Nome do cliente"></div>
      <div><label>Analista</label><input id="analista" placeholder="Seu nome"></div>
    </div>
    <div style="margin-top:10px" class="row">
      <button id="gen" class="btn p">Gerar laudo</button>
      <button id="pdf" class="btn g" disabled>Exportar PDF</button>
    </div>
  </section>

  <section id="laudo" class="hidden">
    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:center">
        <div class="brandbox"><img id="logoOut"><div><div class="h1" id="brandOut">Laudo</div><div class="muted" id="taglineOut"></div></div></div>
        <div class="row"><span class="badge" id="dataHoje"></span><span class="badge" id="laudoId"></span></div>
      </div>
      <div class="muted" id="ident"></div>
      <div class="row" style="margin-top:6px"><span class="badge">Subtom: <b id="subtom"></b></span><span class="badge">Contraste: <b id="contraste"></b></span><span class="badge">Intensidade: <b id="intensidade"></b></span></div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 8px">Estação sugerida</h3>
      <div class="row"><span class="badge" id="estacao"></span></div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 8px">Paletas (referência visual)</h3>
      <div class="grid g2">
        <div><b>Primavera</b><div class="swatches" id="palPrimavera"></div></div>
        <div><b>Verão</b><div class="swatches" id="palVerao"></div></div>
        <div><b>Outono</b><div class="swatches" id="palOutono"></div></div>
        <div><b>Inverno</b><div class="swatches" id="palInverno"></div></div>
      </div>
    </div>

    <div class="card noprint"><button class="btn p" onclick="window.print()">Exportar PDF</button></div>
  </section>
</div>

<div id="toast" class="toast hidden"></div>

<script>
const $=id=>document.getElementById(id);
const showToast=(t)=>{const el=$('toast');el.textContent=t;el.classList.remove('hidden');setTimeout(()=>el.classList.add('hidden'),2200)};
const setThemeColor=(hex)=>{let m=document.querySelector('meta[name=theme-color]');if(!m){m=document.createElement('meta');m.name='theme-color';document.head.appendChild(m)}m.content=hex};
const setPageBg=(hex)=>{document.documentElement.style.setProperty('--page',hex);localStorage.setItem('pageBg',hex);$('bgNow').textContent='Fundo atual: '+hex;setThemeColor(hex)};
const readFile=(f)=>new Promise((res,rej)=>{const r=new FileReader();r.onload=()=>res(r.result);r.onerror=rej;r.readAsDataURL(f)});

async function extractBg(dataURL){return new Promise((ok)=>{const img=new Image();img.onload=()=>{try{const w=img.naturalWidth,h=img.naturalHeight,c=document.createElement('canvas');c.width=w;c.height=h;const x=c.getContext('2d');x.drawImage(img,0,0);const m=Math.max(1,Math.floor(Math.min(w,h)*0.1));function pick(x0,y0,w2,h2){const d=x.getImageData(x0,y0,w2,h2).data;const a=[];for(let i=0;i<d.length;i+=4){if(d[i+3]<200)continue;const Y=0.2126*d[i]+0.7152*d[i+1]+0.0722*d[i+2];if(Y>150)a.push([d[i],d[i+1],d[i+2]])}return a}let s=[...pick(0,0,m,m),...pick(w-m,0,m,m),...pick(0,h-m,m,m),...pick(w-m,h-m,m,m)];if(s.length<64){s=[...s,...pick(0,0,w,m),...pick(0,h-m,w,m),...pick(0,0,m,h),...pick(w-m,0,m,h)]}if(!s.length){ok(null);return}const rs=s.map(v=>v[0]).sort((a,b)=>a-b), gs=s.map(v=>v[1]).sort((a,b)=>a-b), bs=s.map(v=>v[2]).sort((a,b)=>a-b);const med=a=>a[Math.floor(a.length/2)];const hex='#'+[med(rs),med(gs),med(bs)].map(v=>v.toString(16).padStart(2,'0')).join('');ok(hex)}catch(e){console.error(e);ok(null)}};img.onerror=()=>ok(null);img.src=dataURL})}

function swatch(o){return `<div class='sw'><div class='chip' style='background:${o.hex}'></div><div class='meta'><b>${o.name}</b><div>${o.hex}</div></div></div>`}
const pal={Primavera:[{name:'Coral vivo',hex:'#FF6F61'},{name:'Amarelo',hex:'#FFC928'},{name:'Aqua',hex:'#64D8CB'},{name:'Menta',hex:'#9FD3C7'}],Verao:[{name:'Rosa frio',hex:'#F2A7C3'},{name:'Malva',hex:'#B784A7'},{name:'Azul pó',hex:'#A9C1D9'},{name:'Lavanda',hex:'#C7B7E5'}],Outono:[{name:'Terracota',hex:'#C65D3A'},{name:'Mostarda',hex:'#D4A017'},{name:'Oliva',hex:'#6B8E23'},{name:'Teal',hex:'#2A7F62'}],Inverno:[{name:'Azul profundo',hex:'#0F4C81'},{name:'Cobalto',hex:'#1F45FC'},{name:'Borgonha',hex:'#6B0F1A'},{name:'Fúcsia',hex:'#D1006C'}]};
function renderPal(){$('palPrimavera').innerHTML=pal.Primavera.map(swatch).join('');$('palVerao').innerHTML=pal.Verao.map(swatch).join('');$('palOutono').innerHTML=pal.Outono.map(swatch).join('');$('palInverno').innerHTML=pal.Inverno.map(swatch).join('')}

const rules={Q1:{'Bronzeia facilmente':[1,0],'Fica vermelha antes':[0,1]},Q2:{'Dourado/Oliva':[1,0],'Neutro':[0.5,0.5],'Rosado/Azulado':[0,1]},Q3:{'Dourado':[1,0],'Prata':[0,1],'Ambos':[0.5,0.5]},Q4:{'Dourados':[1,0],'Acinzentados':[0,1],'Avermelhados':[1,0],'Neutros':[0.5,0.5]},Q5:{'Quente (dourado/mel)':[1,0],'Neutro':[0.5,0.5],'Frio (acinzentado/azulado)':[0,1]},Q10:{'Branco neve':[1,0],'Branco gelo':[0,1],'Empate':[0.5,0.5]},Q11:{'Coral':[1,0],'Rosa pink':[0,1],'Empate':[0.5,0.5]},Q12:{'Verde oliva':[1,0],'Azul royal':[0,1],'Empate':[0.5,0.5]}};
function score(map){let w=0,c=0;for(const k in rules){const a=map[k];if(a&&rules[k][a]){w+=rules[k][a][0];c+=rules[k][a][1];}}return{w,c}}
function dom(sc){if(sc.w>sc.c+1)return'Warm';if(sc.c>sc.w+1)return'Cool';return'Neutro'}
function contrast(v){return v||'Médio'} function intensity(v){return (v==='Vibrante/Intensa'||v==='Dramática/Profunda')?'Alta':'Baixa'}
function season(d,ctr,int){const t={'Warm|Alto|Alta':'Outono Profundo','Warm|Alto|Baixa':'Outono Quente','Warm|Baixo|Alta':'Primavera Quente','Warm|Baixo|Baixa':'Primavera Clara','Cool|Alto|Alta':'Inverno Frio','Cool|Alto|Baixa':'Inverno Suave','Cool|Baixo|Alta':'Verão Frio','Cool|Baixo|Baixa':'Verão Suave'}; if(d==='Neutro'){if(ctr==='Alto')return 'Intermediária (tende a Inverno/Outono)'; if(ctr==='Baixo') return 'Intermediária (tende a Verão/Primavera)'; return 'Intermediária'} return t[`${d}|${ctr}|${int}`]||'Intermediária'}

$('applyBg').onclick=()=>{setPageBg($('pageBg').value);showToast('Fundo atualizado')};
$('resetBg').onclick=()=>{setPageBg('#d8d2cf');showToast('Fundo restaurado')};
$('brandColor').oninput=(e)=>{document.documentElement.style.setProperty('--brand',e.target.value)};
$('logoFile').onchange=async(e)=>{const f=e.target.files[0];if(!f)return;const data=await readFile(f);localStorage.setItem('logo',data);$('logoPreview').src=data;$('logoOut').src=data;const hex=await extractBg(data);if(hex){setPageBg(hex);showToast('Fundo pela logo: '+hex)}else{showToast('Não deu para detectar o fundo da logo')}};

function pad3(n){return String(n).padStart(3,'0')} function nextSeq(y){const k='seq_'+y;let n=+localStorage.getItem(k)||0;localStorage.setItem(k,++n);return n}
$('gen').onclick=()=>{const v={Q1:$('q1').value,Q2:$('q2').value,Q3:$('q3').value,Q4:$('q4').value,Q5:$('q5').value,Q7:$('q7').value,Q10:$('q10').value,Q11:$('q11').value,Q12:$('q12').value,Q14:$('q14').value};const s=score(v);const D=dom(s),C=contrast(v.Q7),I=intensity(v.Q14);const est=season(D,C,I);const now=new Date();const y=String(now.getFullYear());const id='LA-'+y+'-'+pad3(nextSeq(y));$('brandOut').textContent=$('brandName').value||'Laudo';$('taglineOut').textContent=$('tagline').value||'Colorimetria & Pantone';$('brandPreview').textContent=$('brandOut').textContent;$('taglinePreview').textContent=$('taglineOut').textContent;$('dataHoje').textContent=now.toLocaleDateString('pt-BR');$('laudoId').textContent=id;$('ident').textContent=[$('cliente').value&&('Cliente: '+$('cliente').value),$('analista').value&&('Analista: '+$('analista').value),$('contact').value].filter(Boolean).join(' • ');$('subtom').textContent=D;$('contraste').textContent=C;$('intensidade').textContent=I;$('estacao').textContent=est;renderPal();$('laudo').classList.remove('hidden');$('pdf').disabled=false;window.scrollTo({top:$('laudo').offsetTop-8,behavior:'smooth'});showToast('Laudo gerado ✅')};
$('pdf').onclick=(e)=>{e.preventDefault();window.print()};

(function init(){const bg=localStorage.getItem('pageBg');if(bg){document.documentElement.style.setProperty('--page',bg);$('pageBg').value=bg;$('bgNow').textContent='Fundo atual: '+bg} renderPal();})();
</script>
</body>
</html>
